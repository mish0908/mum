{% extends "base.html" %}

{% block title %}Welcome{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/welcome.css') }}">
{% endblock %}

{% block content %}
<div class="welcome-container">
    <h1 class="animated-title">ç”Ÿæ—¥å¿«æ¨‚! ğŸ‰</h1>
    <div class="confetti-container"></div>
    
    <audio id="bgMusic" loop preload="auto">
        <source src="{{ url_for('static', filename='recording/birthday.mp3') }}" type="audio/mp3">
        ä½ å˜…ç€è¦½å™¨å””æ”¯æŒéŸ³é »æ’­æ”¾ã€‚
    </audio>
    
    <div class="music-controls">
        <button id="playBtn" class="music-btn">
            ğŸµ æ’­æ”¾éŸ³æ¨‚
        </button>
        <button id="pauseBtn" class="music-btn" style="display: none;">
            â¸ï¸ æš«åœéŸ³æ¨‚
        </button>
        <div id="musicStatus" class="music-status"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/confetti.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const audio = document.getElementById('bgMusic');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const musicStatus = document.getElementById('musicStatus');
        
        // Set volume to a reasonable level
        audio.volume = 0.7;
        
        playBtn.addEventListener('click', function() {
            audio.play().then(() => {
                console.log('éŸ³æ¨‚é–‹å§‹æ’­æ”¾');
                playBtn.style.display = 'none';
                pauseBtn.style.display = 'inline-block';
                musicStatus.textContent = 'ğŸµ æ’­æ”¾ç·Š...';
                musicStatus.className = 'music-status playing';
            }).catch((error) => {
                console.error('æ’­æ”¾å¤±æ•—:', error);
                musicStatus.textContent = 'âŒ æ’­æ”¾å¤±æ•—ï¼Œè«‹é‡è©¦';
                musicStatus.className = 'music-status error';
            });
        });
        
        pauseBtn.addEventListener('click', function() {
            audio.pause();
            playBtn.style.display = 'inline-block';
            pauseBtn.style.display = 'none';
            musicStatus.textContent = 'â¸ï¸ å·²æš«åœ';
            musicStatus.className = 'music-status paused';
        });
        
        // Handle when audio ends (though it's looped)
        audio.addEventListener('ended', function() {
            playBtn.style.display = 'inline-block';
            pauseBtn.style.display = 'none';
            musicStatus.textContent = '';
            musicStatus.className = 'music-status';
        });
        
        // Handle audio loading
        audio.addEventListener('loadstart', function() {
            musicStatus.textContent = 'ğŸ“¡ è¼‰å…¥ç·ŠéŸ³æ¨‚...';
            musicStatus.className = 'music-status loading';
        });
        
        audio.addEventListener('canplay', function() {
            if (musicStatus.textContent === 'ğŸ“¡ è¼‰å…¥ç·ŠéŸ³æ¨‚...') {
                musicStatus.textContent = 'âœ… éŸ³æ¨‚æº–å‚™å¥½å–‡ï¼';
                musicStatus.className = 'music-status ready';
                setTimeout(() => {
                    if (musicStatus.className === 'music-status ready') {
                        musicStatus.textContent = '';
                        musicStatus.className = 'music-status';
                    }
                }, 3000);
            }
        });
        
        // Handle errors
        audio.addEventListener('error', function(e) {
            console.error('éŸ³é »éŒ¯èª¤:', e);
            musicStatus.textContent = 'âŒ éŸ³æ¨‚æª”æ¡ˆè¼‰å…¥å¤±æ•—';
            musicStatus.className = 'music-status error';
        });
    });
</script>
{% endblock %} 